# 百度地图实时路况图片抓取

## 使用说明

可执行文件: crawling.exe

命令行参数：

| 参数        | 说明                             |       缺省值       |
| :---------- | :------------------------------- | :----------------: |
| `-d string` | 图片输出目录                     |    当前工作目录    |
| `-i int`    | 最大间隔分钟数                   |         1          |
| `-l int`    | 抓取的瓦片图级别                 |         9          |
| `-w int`    | 并行抓取的线程数                 |         1          |
| `-r string` | 抓取区域的坐标，矩形区域对角坐标 |         无         |
| `-t`        | 测试模式，只执行一次抓取即退出   |   禁用(循环模式)   |
| `-a`        | 使用高德地图                     | 禁用(使用百度地图) |
| `-k`        | 高德 API key 文件名              |      keys.txt      |

例子 1：抓取上海市黄浦区的(百度)实时路况图片，文件保存在 `bmap/` 目录下，每至多 5 分钟抓取一次，级别 17，使用 10 个线程并行抓取

`./crawling.exe -d bmap/ -i 5 -l 17 -w 10 -r "121.4595,31.1939,121.5150,31.2503"`

例子 2：测试抓取上海市黄浦区的(百度)实时路况图片，文件保存在当前目录下，只抓取一次，级别 16，单线程抓取

`./crawling.exe -t -l 16 -r "121.4595,31.1939,121.5150,31.2503"`

例子 3：抓取上海市黄浦区的(高德)实时路况图片，文件保存在 `amap/` 目录下，每至多 5 分钟抓取一次，级别 16，使用 5 个线程并行抓取

`./crawling.exe -d amap/ -i 5 -l 16 -w 5 -a -r "121.4595,31.1939,121.5150,31.2503"`

例子 4：测试抓取上海市黄浦区的(高德)实时路况图片，文件保存在当前目录下，只抓取一次，级别 16，单线程抓取

`./crawling.exe -t -l 16 -a -r "121.4595,31.1939,121.5150,31.2503"`

### 提示：

1. 抓取的瓦片图级别最大为 18，级别越大，分辨率越大，需抓取的瓦片图数量越多，建议使用多线程并行以提高抓取速度
2. 高德对多线程并行抓取较为敏感，线程数不要太大，满足速度要求即可，否则容易抓取失败
3. 高德对于 API 数据抓取有监测，所以抓取周期改为随机，-i 参数设定的是最大间隔时间而非固定周期
4. 为应对高德的 API 数据抓取监测，最好使用多个 key 进行抓取，程序会随机选用，key 保存在`keys.txt`中，每行一个
5. 百度地图请在 `https://api.map.baidu.com/lbsapi/getpoint/index.html` 上拾取相关区域的坐标
6. 高德地图请在 `https://lbs.amap.com/console/show/picker` 上拾取相关区域的坐标

## 坐标数据

| 区域         |                坐标                 |
| :----------- | :---------------------------------: |
| 上海市黄浦区 | `121.4595,31.1939,121.5150,31.2503` |
| 安徽省       | `114.4000,28.6000,120.0000,35.2000` |
